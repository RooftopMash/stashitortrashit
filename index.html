<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stash or Trash???</title>
  </head>
  <body>
    <!-- Add a basic login form -->
    <div id="login">
      <input type="email" id="email" placeholder="Enter email" />
      <input type="password" id="password" placeholder="Enter password" />
      <button id="login-btn">Log In</button>
    </div>

    <div id="app" style="display: none;"> <!-- Initially hidden until login -->
      <header>
        <h1>Stash or Trash???</h1>
      </header>

      <main>
        <div class="rating-card">
          <h2>What do you think of Coca-Cola?</h2>
          <button class="stash">🔥 Stash</button>
          <button class="trash">🗑️ Trash</button>
        </div>

        <!-- New section to rate the AI -->
        <section class="rate-ai">
          <h2>Rate Your AI Assistant!</h2>
          <p>How helpful was the AI?</p>
          <button class="rate-durability">💪 Durability</button>
          <button class="rate-functionality">🛠️ Functionality</button>
          <button class="rate-helpfulness">🤝 Helpfulness</button>
        </section>
      </main>

      <footer>
        <p>Login to comment & rate. Global reviews, local voice.</p>
      </footer>
    </div>

    <!-- Firebase SDK Scripts -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
      import { getFirestore, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBu1iRSWC3l7VGJvHyD49xXqqGdEIa9Kis",
        authDomain: "stashortrash-acbbf.firebaseapp.com",
        projectId: "stashortrash-acbbf",
        storageBucket: "stashortrash-acbbf.firebasestorage.app",
        messagingSenderId: "782905521538",
        appId: "1:782905521538:web:856d1e7789edd76882cb9b",
        measurementId: "G-8Y4ZXJTPM6"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth();

      // Add event listener for the login button
      document.getElementById("login-btn").addEventListener("click", () => {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        signInWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            const user = userCredential.user;
            alert("Logged in successfully!");
            document.getElementById("login").style.display = "none"; // Hide login form
            document.getElementById("app").style.display = "block"; // Show app content
          })
          .catch((error) => {
            const errorMessage = error.message;
            alert(`Login failed: ${errorMessage}`);
          });
      });

      // Product Rating Buttons
      const stashBtn = document.querySelector(".stash");
      const trashBtn = document.querySelector(".trash");

      stashBtn.addEventListener("click", () => rateProduct("stash"));
      trashBtn.addEventListener("click", () => rateProduct("trash"));

      async function rateProduct(rating) {
        const productRef = doc(db, "ratings", "CocaCola");
        try {
          await updateDoc(productRef, {
            [rating]: increment(1)
          });
          alert(`You rated Coca-Cola as ${rating === 'stash' ? 'Stash' : 'Trash'}`);
        } catch (error) {
          console.error("Error updating product rating:", error);
        }
      }

      // AI Rating Buttons
      const durabilityBtn = document.querySelector(".rate-durability");
      const functionalityBtn = document.querySelector(".rate-functionality");
      const helpfulnessBtn = document.querySelector(".rate-helpfulness");

      durabilityBtn.addEventListener("click", () => rateAI("durability"));
      functionalityBtn.addEventListener("click", () => rateAI("functionality"));
      helpfulnessBtn.addEventListener("click", () => rateAI("helpfulness"));

      async function rateAI(ratingType) {
        const aiRef = doc(db, "ai_ratings", "assistant");
        try {
          await updateDoc(aiRef, {
            [ratingType]: increment(1)
          });
          alert(`You rated the AI's ${ratingType} as 👍!`);
        } catch (error) {
          console.error("Error updating AI rating:", error);
        }
      }
    </script>
  </body>
</html>
